---
title: "LDP Project T3"
author: "Chloe Hunt, Amina Harrath"
format: revealjs
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished presentation. To learn more about Quarto presentations see <https://quarto.org/docs/presentations/>.

## Bullets

When you click the **Render** button a document will be generated that includes:

-   Content authored with markdown
-   Output from executable code

## Data Exploration

When you click the **Render** button a presentation will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
#| label: ‘load the data’
#| echo: false

# Load libraries
library(haven)
library(dplyr)
library(ggplot2)
library(tidyr)

## Load data
## Parental questionnaires 
# Parental Trauma Responses Questionnaire 
PTRQ_t1 <- read_sav("00.Raw_Data/T1/Parent/p1_PTRQ_(Parent Trauma Response Questionnaire).sav")
PTRQ_t2 <- read_sav("00.Raw_Data/T2/Parent/p2_PTRQ_(Parent Trauma Response Questionnaire).sav")
PTRQ_t3 <- read_sav("00.Raw_Data/T3/Parent/p3_PTRQ_(Parent Trauma Response Questionnaire).sav")

# Parental overprotection scale
POI_t1 <- read_sav("00.Raw_Data/T1/Parent/p1_POI_(Parental Overprotection Scale.sav")
POI_t2 <- read_sav("00.Raw_Data/T2/Parent/p2_POI_(Parental Overprotection Scale).sav")
POI_t3 <- read_sav("00.Raw_Data/T3/Parent/p3_POI_(Parental Overprotection Scale).sav")

# Child questionnaires
# Child Post-Traumatic Cognition Inventory
CPTCI_t1 <- read_sav("00.Raw_Data/T1/Child and Teenager/c1_CPTCI_(Child Posttraumatic Cognitions Inventory).sav")
CPTCI_t2 <- read_sav("00.Raw_Data/T2/Child and Teenager/c2_CPTCI_(Child Postraumatic Cognitions Inventory).sav")
CPTCI_t3 <- read_sav("00.Raw_Data/T3/Child and Teenager/c3_CPTCI_(Child Posttraumatic Cognitions Inventory).sav")

# Multidimensional scale of perceived social support
MPSS_t1 <- read_sav("00.Raw_Data/T1/Child and Teenager/c1_MSPSS (Multidimensional Scale of Perceived Social Support).sav")
MPSS_t2 <- read_sav("00.Raw_Data/T2/Child and Teenager/c2_MSPSS (Multidimensional Scale of Perceived Social Support).sav")

# Child posttrauma behaviour questionnaire
CPBQ_t1 <- read_sav("00.Raw_Data/T1/Child and Teenager/c1_CPBQ_(Child Posttrauma Behaviours Questionnaire).sav")
CPBQ_t2 <- read_sav("00.Raw_Data/T2/Child and Teenager/c2_CPBQ_(Child Posttrauma Behaviours Questionnaire).sav")
CPBQ_t3 <- read_sav("00.Raw_Data/T3/Child and Teenager/c3_CPBQ_(Child Posttrauma Behaviours Questionnaire).sav")

# Child memory questionnaire
ACTMQ_t1 <- read_sav("00.Raw_Data/T1/Child and Teenager/c1_ACTMQ_(Adapted Child Trauma Memory Questionnaire).sav")
ACTMQ_t2 <- read_sav("00.Raw_Data/T2/Child and Teenager/c2_ACTMQ_(Adapted Child Trauma Memory Questionnaire).sav")
ACTMQ_t3 <- read_sav("00.Raw_Data/T3/Child and Teenager/c3_ACTMQ_(Adapted Child Trauma Memory Questionnaire).sav")


## Merge the dataset wide
# Merge parent datasets
# Standardize IDs to 3-digit character format with leading zeros
PTRQ_t1 <- PTRQ_t1 |>
  mutate(ID = sprintf("%03d", as.integer(ID)))
POI_t1 <- POI_t1 |>
  mutate(ID = as.character(ID))  # Just to be safe
parent_t1 <- PTRQ_t1 |>
  full_join(POI_t1, by = "ID", suffix = c("_ptrq", "_poi"))

# Time 2
PTRQ_t2 <- PTRQ_t2 |>
  mutate(ID = sprintf("%03d", as.integer(ID)))
POI_t2 <- POI_t2 |>
  mutate(ID = as.character(ID))  # Just to be safe
parent_t2 <- PTRQ_t2 |>
  full_join(POI_t2, by = "ID", suffix = c("_ptrq", "_poi"))

# Time 3
PTRQ_t3 <- PTRQ_t3 |>
  mutate(ID = sprintf("%03d", as.integer(ID)))
POI_t3 <- POI_t3 |>
  mutate(ID = as.character(ID))  # Just to be safe
parent_t3 <- PTRQ_t3 |>
  full_join(POI_t3, by = "ID", suffix = c("_ptrq", "_poi"))

## Combine parent datasets wide
parent_t1 <- parent_t1 |> rename_with(~ paste0(.x, "_t1"), -ID)
parent_t2 <- parent_t2 |> rename_with(~ paste0(.x, "_t2"), -ID)
parent_t3 <- parent_t3 |> rename_with(~ paste0(.x, "_t3"), -ID)
parent_all <- parent_t1 |>
  full_join(parent_t2, by = "ID") |>
  full_join(parent_t3, by = "ID")


## Merge child datasets wide
# Time 1
child_t1 <- CPBQ_t1 |>
  full_join(CPTCI_t1, by = "ID", suffix = c("_cpbq", "_cptci")) |>
  full_join(ACTMQ_t1, by = "ID", suffix = c("", "_actmq"))

# Time 2
child_t2 <- CPBQ_t2 |>
  full_join(CPTCI_t2, by = "ID", suffix = c("_cpbq", "_cptci")) |>
  full_join(ACTMQ_t2, by = "ID", suffix = c("", "_actmq"))

# Time 3
child_t3 <- CPBQ_t3 |>
  full_join(CPTCI_t3, by = "ID", suffix = c("_cpbq", "_cptci")) |>
  full_join(ACTMQ_t3, by = "ID", suffix = c("", "_actmq"))

## Combine child datasets wide
child_t1 <- child_t1 |> rename_with(~ paste0(.x, "_t1"), -ID)
child_t2 <- child_t2 |> rename_with(~ paste0(.x, "_t2"), -ID)
child_t3 <- parent_t3 |> rename_with(~ paste0(.x, "_t3"), -ID)
child_all <- child_t1 |>
  full_join(child_t2, by = "ID") |>
  full_join(parent_t3, by = "ID")

## Combine parent and child datasets long
## Add group variable
parent_all <- parent_all |>
  mutate(group = "parent")
child_all <- child_all |>
  mutate(group = "child")

# Rename ID so they are not duplicate
parent_all <- parent_all |>
  mutate(ID = paste0("P_", ID), group = "parent")
child_all <- child_all |>
  mutate(ID = paste0("C_", ID), group = "child")

## Combine both datasets, wide
combined_all <- bind_rows(parent_all, child_all)

```

Visual exploration
```{r}
#| label: ‘prep parent data viz’
#| echo: false
glimpse(parent_all)
summary(parent_all)

# Step 1: Filter PQRST columns (example pattern: 'ptrq' in name)
ptrq_data_t1 <- PTRQ_t1 |>
  pivot_longer(cols = -ID,
               names_to = "question",
               values_to = "response")


  select(ID, contains("pqrst"))
ptrq_long <- ptrq_data |>
  pivot_longer(
    cols = -ID,
    names_to = "question",
    values_to = "response")

ptrq_long <- ptrq_long |>
  filter(!is.na(response)) |>
  mutate(
    response = factor(
      response,
      levels = c("Not at all", "A little", "Some", "A lot")),
    question = as.numeric(as.factor(question)))

# Calculate proportion per question response
prop_data <- ptrq_long |>
  count(question, response) |>
  group_by(question) |>
  mutate(prop = n / sum(n))


```


Design model
```{r}
#| label: ‘create model’



```


